struct PlayerData {
  teams: arr,
}
struct Team {
  players: arr,
}

fn init() {
  sugarcane::info("initializing bedwars")

  teams = map {}
  teams.insert("red", Team {
    players: [],
  })
  teams.insert("green", Team {
    players: [],
  })
  teams.insert("blue", Team {
    players: [],
  })
  teams.insert("yellow", Team {
    players: [],
  })
  sc = sugarcane::instance()
  sc.store(teams)
}

fn add_player_to_team(player, team) {
  sc = sugarcane::instance()
  teams = sc.lock()
  for i = 0, i < teams.len(), i++ {
    if teams[i].color == team {
      teams[i].players.push(player)
      break
    }
  }
  sc.unlock(teams)
}

fn find_smallest_team() {
  sc = sugarcane::instance()
  teams = sc.lock()
  sugarcane::info("foo 1")
  smallest_size = 100
  smallest_team = ""
  sugarcane::info("foo 2")
  for i = 0, i < teams.len(), i++ {
    sugarcane::info("foo 3")
    sugarcane::info(teams)
    sugarcane::info(teams[i])
    sugarcane::info()
    sugarcane::info()
    if teams[i].players.len() < smallest_size {
      smallest_team = teams[i].color
      smallest_size = teams[i].players.len()
    }
  }
  sugarcane::info("foo 4")
  sc.unlock(teams)
  smallest_team
}

fn start_game(sc) {

}

fn on_click_window(player, slot, mode) {
  true
}

fn on_block_place(player, pos, kind) {
  sugarcane::info("placing block")
}

fn on_player_join(player) {
  team = find_smallest_team()
  sugarcane::info("Adding " + player.username() + " to " + team)
  add_player_to_team(player, team)
}
